#!/bin/bash

# Define paths
APP_NAME="Canda"
ORIG_APP="/System/Applications/Utilities/Terminal.app"
NEW_APP="$HOME/Applications/$APP_NAME.app"
ICON_PATH="$HOME/Desktop/Canda.icns"  # <-- Path to your Canda icon file

# Step 1: Create the app directory structure
echo "Creating app structure..."
mkdir -p "$NEW_APP/Contents/MacOS"
mkdir -p "$NEW_APP/Contents/Resources"

# Step 2: Create an AppleScript that will run the prank script
echo "Creating AppleScript to run prank script..."
cat <<EOF > "$NEW_APP/Contents/MacOS/launch_prank.scpt"
do shell script "sh $HOME/Applications/Canda_Hyper_prank.sh"
EOF

# Step 3: Make the AppleScript executable
chmod +x "$NEW_APP/Contents/MacOS/launch_prank.scpt"

# Step 4: Set the custom icon for the app
if [ -f "$ICON_PATH" ]; then
  echo "Replacing app icon..."
  cp "$ICON_PATH" "$NEW_APP/Contents/Resources/Canda.icns"
  # Set custom icon using SetFile
  SetFile -a C "$NEW_APP"
else
  echo "⚠️ Icon file not found at $ICON_PATH. Skipping icon replacement."
fi

# Step 5: Remove quarantine flags from the new app
echo "Removing quarantine flags..."
xattr -cr "$NEW_APP"

# Step 6: Re-sign the app to ensure it can be opened
echo "Re-signing the app..."
codesign --force --deep --sign - "$NEW_APP"

# Step 7: Open the new app
echo "Canda.app created successfully at $NEW_APP"
open "$NEW_APP"
