#!/bin/bash

# App names and paths
APP_NAME="Canda"
ORIG_APP="/System/Applications/Utilities/Terminal.app"
NEW_APP="$HOME/Applications/$APP_NAME.app"
ICON_PATH="$HOME/Desktop/Canda.icns"  # <-- Path to your Canda.icns icon

# Step 1: Copy the original Terminal app to the new app
echo "Copying Terminal.app to $NEW_APP..."
cp -R "$ORIG_APP" "$NEW_APP"

# Step 2: Replace the icon with your custom Canda.icns icon
if [ -f "$ICON_PATH" ]; then
  echo "Replacing icon..."
  # Create necessary folder and copy the icon
  mkdir -p "$NEW_APP/Contents/Resources"
  cp "$ICON_PATH" "$NEW_APP/Contents/Resources/Terminal.icns"
else
  echo "⚠️  Icon file not found at $ICON_PATH. Make sure the Canda.icns file is on your Desktop."
  exit 1
fi

# Step 3: Set the custom icon for the app (using 'SetFile' command)
echo "Setting the custom icon..."
SetFile -a C "$NEW_APP"

# Step 4: Remove any quarantine flags on the new app (avoid 'damaged' warnings)
echo "Removing quarantine flags..."
xattr -cr "$NEW_APP"

# Step 5: Re-sign the app to prevent Gatekeeper issues (optional but important)
echo "Re-signing the app..."
codesign --force --deep --sign - "$NEW_APP"

# Step 6: Done! Notify user and open the new app
echo "✅ Canda.app created successfully in $NEW_APP"
open "$NEW_APP"
